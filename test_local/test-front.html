<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TestFront</title>
    <!--<script src="./ContrastTests.mjs" type="module"></script>-->
    <!--<script src="https://unpkg.com/@libp2p/webrtc/dist/index.min.js"></script>-->
    
    <style>
        .utxoList {
            border: 1px solid black;
        }
        .utxoLine {
            display: flex;
            margin: 5px;
            padding: 5px;
        }
        .utxoLine div {
            width: 100px;
        }
    </style>
</head>

<body>
    <div id="utxosList"></div>

    <!--<script>
        const ws = new WebSocket('ws://localhost:3000');
        ws.onopen = function() {
            console.log('Connection opened');
        };

        ws.onmessage = function(event) {
            //console.log('Message received : ' + event.data);
            //console.log('Message received : ' + JSON.stringify(event.data));
            const data = JSON.parse(event.data);
            //console.log('Message received : ', data);

            if (data.memPool && data.memPool.transactionsByID) {
                //console.log('received: transactionsByID');
                //console.log(data.memPool.transactionsByID);
            }

            if (data.utxoCache && data.utxoCache.addressesUTXOs) {
                //console.log('received: addressesUTXOs');
                //console.log(data.utxoCache.addressesUTXOs);
                //console.log(JSON.stringify(data.utxoCache.addressesUTXOs));
                displayUTXOs(data.utxoCache);
            }
        };

        ws.onclose = function() {
            console.log('Connection closed');
        };

        ws.onerror = function(error) {
            console.log('Erreur WebSocket : ' + error);
        };


        function createAddressesUTXOLine(address, amount, anchor, rule, version) {
            const line = document.createElement('li');
            line.classList.add('utxoLine');
            // add div for each element
            const addressDiv = document.createElement('div');
            addressDiv.style.width = '220px';
            addressDiv.textContent = address;
            line.appendChild(addressDiv);

            const amountDiv = document.createElement('div');
            amountDiv.style.width = '140px';
            amountDiv.textContent = amount;
            line.appendChild(amountDiv);

            const anchorDiv = document.createElement('div');
            anchorDiv.style.width = '160px';
            anchorDiv.textContent = anchor;
            line.appendChild(anchorDiv);

            const ruleDiv = document.createElement('div');
            ruleDiv.textContent = rule;
            line.appendChild(ruleDiv);

            const versionDiv = document.createElement('div');
            versionDiv.style.width = '60px';
            versionDiv.textContent = version;
            line.appendChild(versionDiv);

            return line;
        }
        function displayUTXOs(utxoCache) {
            const utxos = utxoCache.addressesUTXOs;
            const lastBlockMiningData = utxoCache.blockMiningData[utxoCache.blockMiningData.length - 1];
            const blockIndex = lastBlockMiningData.index;

            const container = document.getElementById('utxosList');
            const wrap = document.createElement('div');
            wrap.style.border = '1px solid black';

            const title = document.createElement('h2');
            title.textContent = `Block Index: ${blockIndex}`;
            wrap.appendChild(title);

            Object.keys(utxos).forEach(address => {
                const addressElement = document.createElement('div');
                addressElement.textContent = `Address: ${address}`;
                wrap.appendChild(addressElement);

                const listElement = document.createElement('ul');
                listElement.classList.add('utxoList');
                listElement.appendChild(createAddressesUTXOLine('Address', 'Amount', 'anchor', 'Rule', 'Version'));

                utxos[address].forEach(utxo => {
                    listElement.appendChild(createAddressesUTXOLine(utxo.address, utxo.amount, utxo.anchor, utxo.rule, utxo.version));
                });

                wrap.appendChild(listElement);
            });

            container.appendChild(wrap);
        }
    </script>-->
</body>