<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TestFront</title>
    <!--<script src="./ContrastTests.mjs" type="module"></script>-->

    <style>
        .utxoList {
            border: 1px solid black;
        }
        .utxoLine {
            display: flex;
            margin: 5px;
            padding: 5px;
        }
        .utxoLine div {
            width: 100px;
        }
    </style>
</head>

<body>
    <div id="utxosList"></div>

    <script>
        const ws = new WebSocket('ws://localhost:3000');
        ws.onopen = function() {
            console.log('Connection opened');
        };

        ws.onmessage = function(event) {
            //console.log('Message received : ' + event.data);
            //console.log('Message received : ' + JSON.stringify(event.data));
            const data = JSON.parse(event.data);
            //console.log('Message received : ', data);

            if (data.memPool && data.memPool.transactionsByID) {
                //console.log('received: transactionsByID');
                //console.log(data.memPool.transactionsByID);
            }

            if (data.hotData && data.hotData.addressesUTXOs) {
                //console.log('received: addressesUTXOs');
                //console.log(data.hotData.addressesUTXOs);
                //console.log(JSON.stringify(data.hotData.addressesUTXOs));
                displayUTXOs(data.hotData);
            }
        };

        ws.onclose = function() {
            console.log('Connection closed');
        };

        ws.onerror = function(error) {
            console.log('Erreur WebSocket : ' + error);
        };


        function createAddressesUTXOLine(address, amount, rule, utxoBlockHeight, utxoTxID, version, vout) {
            const line = document.createElement('li');
            line.classList.add('utxoLine');
            // add div for each element
            const addressDiv = document.createElement('div');
            addressDiv.style.width = '220px';
            addressDiv.textContent = address;
            line.appendChild(addressDiv);

            const amountDiv = document.createElement('div');
            amountDiv.textContent = amount;
            line.appendChild(amountDiv);

            const ruleDiv = document.createElement('div');
            ruleDiv.textContent = rule;
            line.appendChild(ruleDiv);

            const utxoBlockHeightDiv = document.createElement('div');
            utxoBlockHeightDiv.textContent = utxoBlockHeight;
            line.appendChild(utxoBlockHeightDiv);

            const utxoTxIDDiv = document.createElement('div');
            utxoTxIDDiv.textContent = utxoTxID;
            line.appendChild(utxoTxIDDiv);

            const versionDiv = document.createElement('div');
            versionDiv.textContent = version;
            line.appendChild(versionDiv);

            const voutDiv = document.createElement('div');
            voutDiv.textContent = vout;
            line.appendChild(voutDiv);

            return line;
        }
        function displayUTXOs(hotData) {
            const utxos = hotData.addressesUTXOs;
            const lastBlockMiningData = hotData.blockMiningData[hotData.blockMiningData.length - 1];
            const blockIndex = lastBlockMiningData.index;

            const container = document.getElementById('utxosList');
            const wrap = document.createElement('div');
            wrap.style.border = '1px solid black';

            const title = document.createElement('h2');
            title.textContent = `Block Index: ${blockIndex}`;
            wrap.appendChild(title);

            Object.keys(utxos).forEach(address => {
                // Créer un élément pour l'adresse
                const addressElement = document.createElement('div');
                addressElement.textContent = `Adresse: ${address}`;
                wrap.appendChild(addressElement);

                const listElement = document.createElement('ul');
                listElement.classList.add('utxoList');
                listElement.appendChild(createAddressesUTXOLine('Address', 'Amount', 'Rule', 'Height', 'UTXO TxID', 'Version', 'Vout'));

                utxos[address].forEach(utxo => {
                    listElement.appendChild(createAddressesUTXOLine(utxo.address, utxo.amount, utxo.rule, utxo.utxoBlockHeight, utxo.utxoTxID, utxo.version, utxo.vout));
                });

                wrap.appendChild(listElement);
            });

            container.appendChild(wrap);
        }
    </script>
</body>